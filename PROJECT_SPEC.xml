<?xml version="1.0" encoding="UTF-8"?>
<!--
  ╔═══════════════════════════════════════════════════════════════════════════╗
  ║                         AUDITCASEOS PROJECT SPECIFICATION                  ║
  ║                                                                            ║
  ║  This XML serves as the single source of truth for project development.    ║
  ║  Provide this file to Claude/AI assistants at the start of each session    ║
  ║  to maintain context and ensure consistent development.                    ║
  ╚═══════════════════════════════════════════════════════════════════════════╝
-->
<project>
  <!-- ============================================== -->
  <!-- METADATA                                       -->
  <!-- ============================================== -->
  <metadata>
    <name>AuditCaseOS</name>
    <tagline>Case management + Evidence vault + Doc intelligence + RAG + Reporting</tagline>
    <description>Internal audit case management system with AI-powered analysis, evidence vault, and smart report generation. A composed-from-existing-projects dockerized bundle designed to be forked and evolved.</description>
    <version>0.4.6</version>
    <repository>https://github.com/SBG4/auditcaseos</repository>
    <last_updated>2026-01-15</last_updated>
    <current_phase>3</current_phase>
    <overall_progress>phase_3_in_progress</overall_progress>
  </metadata>

  <!-- ============================================== -->
  <!-- AI PROMPTING SYSTEM                            -->
  <!-- ============================================== -->
  <prompting>
    <purpose>
      These prompts ensure consistent, high-quality development across sessions.
      Use them as templates when instructing AI assistants to implement features.
    </purpose>

    <!-- Master System Prompt for Development Sessions -->
    <system_prompt name="master_developer">
      <![CDATA[
You are Claude Code acting as a senior engineer. You are working on "AuditCaseOS" - a forkable open-source mono-repo that composes existing OSS projects into a dockerized investigation/audit platform.

GOAL:
An end-to-end system for tracking audit investigations (cases), storing evidence, OCR/indexing documents, similarity search (RAG), and generating Word report drafts. Must be runnable with Docker Compose on Mac.

CURRENT STACK:
1. PostgreSQL + pgvector for case data and embeddings
2. MinIO for evidence storage (S3-compatible)
3. Ollama for local LLM (no external APIs)
4. FastAPI backend ("api" service)
5. Paperless-ngx for OCR (Phase 2)
6. React frontend (Phase 3)

CASE ID SYSTEM:
Format: SCOPE-TYPE-SEQ (e.g., FIN-USB-0001)
- SCOPE: Department code (FIN, HR, IT, SEC, OPS, CORP, LEGAL, RND)
- TYPE: Case type (USB, EMAIL, WEB, POLICY)
- SEQ: Auto-incrementing per scope-type combination

KEY PRINCIPLES:
1. All services must be dockerized and health-checked
2. No hardcoded secrets - use environment variables
3. Keep components reachable on localhost custom ports
4. Implement proper error handling with clear messages
5. Use async/await patterns throughout Python code
6. Follow REST best practices for API design
7. Write clean, typed, documented code
8. **MANDATORY**: Commit and push ALL changes to git before ending ANY session

QUALITY BAR:
- Stack must run without manual code edits after setting .env
- Include clear error messages if tokens/credentials not set
- Use clean project structure and comments
- All endpoints must have OpenAPI documentation
      ]]>
    </system_prompt>

    <!-- Phase-Specific Prompts -->
    <phase_prompts>
      <prompt phase="2" name="database_crud">
        <![CDATA[
Implement complete database CRUD operations for AuditCaseOS.

CONTEXT:
- Database schema exists in configs/postgres/init.sql
- SQLAlchemy models exist in api/app/models/
- Pydantic schemas exist in api/app/schemas/
- Routers have placeholder implementations in api/app/routers/

TASKS:
1. Update api/app/routers/cases.py to use actual database queries
2. Implement proper async SQLAlchemy operations
3. Use the case_service.py for business logic
4. Implement pagination with skip/limit
5. Implement filtering by status, type, scope, severity
6. Implement search in title and description
7. Add proper error handling (404 for not found, etc.)
8. Log all operations to audit_log table

PATTERNS TO FOLLOW:
- Use dependency injection for database sessions
- Use service layer for business logic
- Return proper HTTP status codes
- Include response_model in all endpoints
        ]]>
      </prompt>

      <prompt phase="2" name="authentication">
        <![CDATA[
Implement JWT-based authentication for AuditCaseOS.

REQUIREMENTS:
1. Add password hashing using bcrypt
2. Create POST /api/v1/auth/login endpoint
3. Create POST /api/v1/auth/register endpoint (admin only)
4. Generate JWT tokens with expiration
5. Create authentication middleware
6. Protect all routes except health and login
7. Implement role-based access control (admin, auditor, reviewer, viewer)

FILES TO CREATE/MODIFY:
- api/app/routers/auth.py (new)
- api/app/services/auth_service.py (new)
- api/app/utils/security.py (new)
- api/app/main.py (add auth router)
- api/requirements.txt (add python-jose, passlib, bcrypt)

JWT PAYLOAD:
{
  "sub": "user_id",
  "email": "user@example.com",
  "role": "auditor",
  "exp": timestamp
}
        ]]>
      </prompt>

      <prompt phase="2" name="paperless_integration">
        <![CDATA[
Integrate Paperless-ngx for OCR capabilities.

TASKS:
1. Add paperless service to docker-compose.yml
2. Create api/app/services/paperless_service.py
3. Create sync endpoint POST /api/v1/sync/case/{case_id}
4. Implement evidence file upload to Paperless
5. Retrieve OCR text and store in evidence.extracted_text

DOCKER CONFIG:
paperless:
  image: ghcr.io/paperless-ngx/paperless-ngx:latest
  container_name: auditcaseos-paperless
  environment:
    PAPERLESS_DBHOST: postgres
    PAPERLESS_DBNAME: ${POSTGRES_DB:-auditcaseos}
    PAPERLESS_DBUSER: ${POSTGRES_USER:-auditcaseos}
    PAPERLESS_DBPASS: ${POSTGRES_PASSWORD:-auditcaseos_secret}
    PAPERLESS_SECRET_KEY: ${SECRET_KEY:-change-me}
  ports:
    - "18080:8000"
  volumes:
    - paperless_data:/usr/src/paperless/data
    - paperless_media:/usr/src/paperless/media
  depends_on:
    - postgres

PAPERLESS API ENDPOINTS TO USE:
- POST /api/documents/post_document/ - Upload document
- GET /api/documents/{id}/ - Get document with OCR text
- GET /api/documents/?query=... - Search documents
        ]]>
      </prompt>

      <prompt phase="2" name="entity_extraction">
        <![CDATA[
Implement entity extraction from evidence text.

ENTITIES TO EXTRACT:
1. Employee IDs: Pattern EMP-[0-9]{6}
2. IP Addresses: Standard IPv4 pattern
3. Email Addresses: Standard email pattern
4. Hostnames: Pattern [A-Z]{2,4}-[A-Z0-9]{4,10}
5. Department Keywords: Match against scopes table

FILES TO CREATE:
- api/app/services/entity_service.py
- api/app/models/entity.py
- api/app/schemas/entity.py
- api/app/routers/entities.py

DATABASE TABLE:
CREATE TABLE case_entities (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    case_id UUID NOT NULL REFERENCES cases(id),
    entity_type VARCHAR(50) NOT NULL,
    entity_value VARCHAR(500) NOT NULL,
    source VARCHAR(50),
    evidence_id UUID REFERENCES evidence(id),
    confidence FLOAT DEFAULT 1.0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(case_id, entity_type, entity_value)
);

ENDPOINTS:
- GET /api/v1/entities/case/{case_id}
- GET /api/v1/entities/search?type=...&value=...
- GET /api/v1/entities/employee/{employee_id}/cases
- GET /api/v1/entities/computer/{hostname}/cases
        ]]>
      </prompt>

      <prompt phase="2" name="rag_implementation">
        <![CDATA[
Implement RAG (Retrieval-Augmented Generation) with pgvector.

COMPONENTS:
1. Embedding Service - Generate vectors using Ollama
2. Similarity Search - Query pgvector for similar cases
3. AI Summarization - Generate case summaries

EMBEDDING MODEL: nomic-embed-text (via Ollama)
VECTOR DIMENSION: 768 (for nomic-embed-text)

FILES TO CREATE/MODIFY:
- api/app/services/embedding_service.py (new)
- api/app/services/ollama_service.py (update)
- api/app/routers/ai.py (update)
- configs/postgres/init.sql (update embedding dimension)

EMBEDDING SERVICE METHODS:
- embed_text(text: str) -> list[float]
- embed_case(case_id: UUID) -> None
- embed_evidence(evidence_id: UUID) -> None
- batch_embed_case(case_id: UUID) -> None

SIMILARITY SEARCH:
SELECT e.entity_id, e.entity_type,
       1 - (e.embedding <=> query_vector) as similarity
FROM embeddings e
WHERE e.entity_type = 'case'
  AND 1 - (e.embedding <=> query_vector) > 0.7
ORDER BY similarity DESC
LIMIT 10;

OLLAMA API CALLS:
- POST http://ollama:11434/api/embeddings
  {"model": "nomic-embed-text", "prompt": "text to embed"}
- POST http://ollama:11434/api/generate
  {"model": "llama3.2", "prompt": "...", "stream": false}
        ]]>
      </prompt>

      <prompt phase="2" name="report_generation">
        <![CDATA[
Implement DOCX report generation using python-docx.

REPORT SECTIONS:
1. Cover Page - Case ID, title, date, classification
2. Executive Summary - AI-generated overview
3. Case Details - Full metadata, involved parties
4. Timeline - Chronological event listing
5. Findings - Severity-sorted findings with recommendations
6. Evidence List - Files with hashes and descriptions
7. Similar Cases - Related cases from RAG search
8. Appendix - Raw data, entity list

FILES TO CREATE:
- api/app/services/report_service.py
- api/app/routers/reports.py
- api/templates/ (directory for DOCX templates)

ENDPOINT:
GET /api/v1/reports/case/{case_id}.docx
Query params:
- template: STANDARD|EXECUTIVE_SUMMARY|DETAILED|COMPLIANCE
- include_evidence: bool
- include_similar: bool
- watermark: str (optional)

PYTHON-DOCX EXAMPLE:
from docx import Document
from docx.shared import Inches, Pt
from docx.enum.text import WD_ALIGN_PARAGRAPH

doc = Document()
doc.add_heading(f'Case Report: {case_id}', 0)
doc.add_paragraph(f'Generated: {datetime.now()}')
# ... build sections
doc.save(buffer)
        ]]>
      </prompt>

      <prompt phase="3" name="react_frontend">
        <![CDATA[
Create React frontend for AuditCaseOS.

SETUP:
npm create vite@latest frontend -- --template react-ts
cd frontend
npm install tailwindcss postcss autoprefixer
npm install react-router-dom @tanstack/react-query axios
npm install @heroicons/react date-fns

DIRECTORY STRUCTURE:
frontend/
├── src/
│   ├── components/
│   │   ├── common/        # Buttons, inputs, modals
│   │   ├── cases/         # Case-related components
│   │   ├── evidence/      # Evidence components
│   │   ├── layout/        # Header, sidebar, footer
│   │   └── reports/       # Report components
│   ├── pages/
│   │   ├── Dashboard.tsx
│   │   ├── CaseList.tsx
│   │   ├── CaseDetail.tsx
│   │   ├── CaseCreate.tsx
│   │   ├── Reports.tsx
│   │   ├── Login.tsx
│   │   └── Admin.tsx
│   ├── services/
│   │   └── api.ts         # Axios client
│   ├── hooks/
│   │   └── useAuth.ts     # Auth hook
│   ├── context/
│   │   └── AuthContext.tsx
│   ├── types/
│   │   └── index.ts       # TypeScript types
│   └── App.tsx
├── Dockerfile
└── nginx.conf

DOCKER CONFIG:
frontend:
  build:
    context: ./frontend
    dockerfile: Dockerfile
  container_name: auditcaseos-frontend
  ports:
    - "13000:80"
  depends_on:
    - api
        ]]>
      </prompt>
    </phase_prompts>

    <!-- Best Practices for AI Prompting -->
    <best_practices>
      <practice name="context_setting">
        <description>Always provide full context at the start of a session</description>
        <example>
          <![CDATA[
"I'm continuing development on AuditCaseOS. Here's the PROJECT_SPEC.xml: [paste XML]
We're currently on Phase 2, feature 2.3 (Paperless Integration).
Please implement the Paperless service connector."
          ]]>
        </example>
      </practice>

      <practice name="specific_tasks">
        <description>Break down features into specific, actionable tasks</description>
        <example>
          <![CDATA[
"Implement the following for entity extraction:
1. Create the EntityService class with extract_from_text() method
2. Add regex patterns for employee IDs, IPs, emails
3. Create the database model and migration
4. Add the API endpoint GET /entities/case/{case_id}"
          ]]>
        </example>
      </practice>

      <practice name="file_references">
        <description>Reference specific files when making changes</description>
        <example>
          <![CDATA[
"Update api/app/routers/cases.py to:
- Replace placeholder in list_cases() with actual DB query
- Use CaseService.list_cases() from api/app/services/case_service.py
- Follow the pattern in api/app/routers/scopes.py"
          ]]>
        </example>
      </practice>

      <practice name="testing_verification">
        <description>Always request verification after implementation</description>
        <example>
          <![CDATA[
"After implementing, please:
1. Run docker compose up --build to verify it builds
2. Test the endpoint with curl
3. Check logs for any errors
4. Update PROJECT_SPEC.xml to mark feature as COMPLETED"
          ]]>
        </example>
      </practice>

      <practice name="incremental_development">
        <description>Build incrementally, one feature at a time</description>
        <example>
          <![CDATA[
"Let's implement Phase 2 features in order:
1. First, complete feature 2.1 (Database CRUD)
2. Test thoroughly
3. Commit to git
4. Then move to feature 2.2 (Authentication)
Do not skip ahead or implement multiple features at once."
          ]]>
        </example>
      </practice>

      <practice name="error_handling">
        <description>Specify error handling requirements</description>
        <example>
          <![CDATA[
"Implement with proper error handling:
- Return 404 with message if case not found
- Return 400 for invalid input with field-level errors
- Return 500 with generic message for unexpected errors
- Log all errors to audit_log with stack trace"
          ]]>
        </example>
      </practice>
    </best_practices>

    <!-- MANDATORY RULES - These MUST be followed without exception -->
    <mandatory_rules>
      <rule id="1" name="git_commit_before_handover" severity="CRITICAL">
        <description>
          ALWAYS commit and push all changes to git before ending a session or handing
          control back to the user. No exceptions. This ensures all work is preserved
          and the repository stays in sync.
        </description>
        <actions>
          <action>1. Stage all modified/new files: git add -A</action>
          <action>2. Commit with descriptive message summarizing changes</action>
          <action>3. Push to remote: git push</action>
          <action>4. Verify push succeeded before ending session</action>
        </actions>
        <trigger>Before ANY session end, task completion, or user handover</trigger>
      </rule>
      <rule id="2" name="update_spec_on_completion" severity="HIGH">
        <description>
          Update PROJECT_SPEC.xml to reflect completed features and changes.
          Keep the spec as the single source of truth.
        </description>
      </rule>
    </mandatory_rules>

    <!-- Session Start Template -->
    <session_template>
      <![CDATA[
=== AUDITCASEOS DEVELOPMENT SESSION ===

PROJECT: AuditCaseOS - Audit Case Management System
REPO: https://github.com/SBG4/auditcaseos
CURRENT PHASE: [1|2|3]
CURRENT FEATURE: [feature_id] - [feature_name]

CONTEXT:
[Paste relevant section of PROJECT_SPEC.xml or describe current state]

OBJECTIVE:
[Clearly state what you want to accomplish in this session]

CONSTRAINTS:
- All code must be dockerized
- Use async/await patterns
- Follow existing code structure
- Update PROJECT_SPEC.xml when feature is complete

EXPECTED OUTPUT:
[Describe what you expect: files created, endpoints working, etc.]

BEGIN:
[Your specific request]
      ]]>
    </session_template>

    <!-- Feature Completion Template -->
    <completion_template>
      <![CDATA[
=== FEATURE COMPLETION CHECKLIST ===

Feature ID: [X.X]
Feature Name: [Name]

□ Code implemented and tested
□ Docker builds successfully
□ Endpoints return expected responses
□ Error handling in place
□ Logs working correctly
□ Documentation updated (if needed)
□ PROJECT_SPEC.xml updated (status = COMPLETED)
□ Changes committed to git
□ Changes pushed to GitHub

NOTES:
[Any issues, limitations, or follow-up tasks]
      ]]>
    </completion_template>
  </prompting>

  <!-- ============================================== -->
  <!-- ORIGINAL PROJECT CONCEPT                       -->
  <!-- ============================================== -->
  <original_concept>
    <description>
      A "composed-from-existing-projects" idea that combines open-source
      docker-friendly components into a unified audit/investigation platform.
    </description>

    <components>
      <component name="Case Management" selected="Custom FastAPI">
        <alternative>DFIR-IRIS</alternative>
        <reason>Custom solution allows unified case ID system and simpler integration</reason>
      </component>
      <component name="Evidence Storage" selected="MinIO">
        <alternative>Nextcloud</alternative>
        <reason>S3-compatible API, simpler for programmatic access</reason>
      </component>
      <component name="Document Intelligence" selected="Paperless-ngx">
        <features>OCR, full-text search, tagging</features>
      </component>
      <component name="Vector Database" selected="PostgreSQL + pgvector">
        <alternative>Chroma, Pinecone, Weaviate</alternative>
        <reason>Single database for all data, simpler ops</reason>
      </component>
      <component name="AI/LLM" selected="Ollama">
        <alternative>OpenAI API</alternative>
        <reason>Fully offline, no API costs, data privacy</reason>
      </component>
      <component name="Collaboration" selected="Nextcloud + ONLYOFFICE" phase="3">
        <features>File sharing, in-browser editing</features>
      </component>
    </components>

    <end_to_end_flow>
      <step number="1">
        <action>Investigator creates a Case</action>
        <result>Case gets unique ID: FIN-USB-0001</result>
        <data>department, employee(s), summary, severity, status, owner</data>
      </step>
      <step number="2">
        <action>Evidence uploaded to MinIO</action>
        <result>Files stored at /cases/FIN-USB-0001/</result>
        <data>exports, screenshots, logs, PDFs</data>
      </step>
      <step number="3">
        <action>Paperless ingests files for OCR</action>
        <result>Text extracted and searchable</result>
      </step>
      <step number="4">
        <action>RAG Gateway indexes everything</action>
        <sources>Case fields, Paperless OCR text, KB docs</sources>
        <storage>pgvector with labels (case|evidence|kb|employee|department)</storage>
        <queries>
          <query>Show similar investigations to this case</query>
          <query>Find all cases similar to Finance USB exfil</query>
          <query>Cross-reference employee ID across investigations</query>
          <query>Draft report executive summary</query>
        </queries>
      </step>
      <step number="5">
        <action>Report Generation</action>
        <output>DOCX from case data + retrieved context</output>
      </step>
    </end_to_end_flow>

    <glue_features>
      <feature name="Case-Folder Binding">
        <description>When case created, auto-create Nextcloud folder and Paperless tags</description>
      </feature>
      <feature name="Evidence Sync Pipeline">
        <description>Sync job lists files, pushes to Paperless, indexes text into pgvector</description>
      </feature>
      <feature name="Cross-Reference Engine">
        <description>Detect employee IDs, usernames, departments; store entities; link to cases</description>
      </feature>
      <feature name="Report Builder">
        <description>DOCX with summary, timeline, evidence, findings, similar cases, appendix</description>
      </feature>
    </glue_features>
  </original_concept>

  <!-- ============================================== -->
  <!-- ARCHITECTURE                                   -->
  <!-- ============================================== -->
  <architecture>
    <diagram>
      <![CDATA[
┌─────────────────────────────────────────────────────────────────┐
│                         AuditCaseOS                              │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │   Frontend   │  │  API Gateway │  │    RAG Engine        │   │
│  │   (React)    │◄─►  (FastAPI)   │◄─► (Embeddings+Search)  │   │
│  │   :13000     │  │    :18000    │  │                      │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
│         │                 │                    │                 │
│         ▼                 ▼                    ▼                 │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                PostgreSQL + pgvector :15432               │   │
│  │  (Cases, Users, Evidence metadata, Embeddings, Audit)     │   │
│  └──────────────────────────────────────────────────────────┘   │
│         │                 │                    │                 │
│         ▼                 ▼                    ▼                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │    MinIO     │  │  Paperless   │  │       Ollama         │   │
│  │  :19000/01   │  │   :18080     │  │      :21434          │   │
│  │  (Evidence)  │  │    (OCR)     │  │   (Local LLM)        │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  (Phase 3)                  │
│  │  Nextcloud   │  │  ONLYOFFICE  │                             │
│  │  (Collab)    │  │  (Editing)   │                             │
│  └──────────────┘  └──────────────┘                             │
└─────────────────────────────────────────────────────────────────┘
      ]]>
    </diagram>

    <stack>
      <backend>FastAPI (Python 3.12)</backend>
      <database>PostgreSQL 16 + pgvector</database>
      <storage>MinIO (S3-compatible)</storage>
      <ai>Ollama (local LLM - llama3.2, nomic-embed-text)</ai>
      <ocr>Paperless-ngx (Phase 2)</ocr>
      <frontend>React + Vite + TypeScript + TailwindCSS (Phase 3)</frontend>
      <collaboration>Nextcloud + ONLYOFFICE (Phase 3)</collaboration>
    </stack>

    <ports>
      <port service="api" external="18000" internal="8000"/>
      <port service="postgres" external="15432" internal="5432"/>
      <port service="minio_api" external="19000" internal="9000"/>
      <port service="minio_console" external="19001" internal="9001"/>
      <port service="ollama" external="21434" internal="11434"/>
      <port service="paperless" external="18080" internal="8000"/>
      <port service="frontend" external="13000" internal="80"/>
    </ports>

    <directory_structure>
      <![CDATA[
auditcaseos/
├── docker-compose.yml
├── docker-compose.phase2.yml      # Phase 2 additions
├── docker-compose.phase3.yml      # Phase 3 additions
├── .env.example
├── .gitignore
├── README.md
├── PROJECT_SPEC.xml               # This file
│
├── api/                           # FastAPI backend
│   ├── Dockerfile
│   ├── requirements.txt
│   └── app/
│       ├── __init__.py
│       ├── main.py
│       ├── config.py
│       ├── database.py
│       ├── models/
│       │   ├── __init__.py
│       │   ├── base.py
│       │   ├── user.py
│       │   ├── scope.py
│       │   ├── case.py
│       │   ├── evidence.py
│       │   ├── finding.py
│       │   ├── entity.py          # Phase 2
│       │   └── audit_log.py
│       ├── schemas/
│       │   ├── __init__.py
│       │   ├── common.py
│       │   ├── user.py
│       │   ├── case.py
│       │   ├── evidence.py
│       │   ├── finding.py
│       │   ├── entity.py          # Phase 2 - DONE
│       │   └── report.py
│       ├── routers/
│       │   ├── __init__.py
│       │   ├── auth.py            # Phase 2 - DONE
│       │   ├── cases.py
│       │   ├── evidence.py
│       │   ├── users.py
│       │   ├── scopes.py
│       │   ├── sync.py            # Phase 2 - DONE
│       │   ├── entities.py        # Phase 2 - DONE
│       │   ├── reports.py         # Phase 2
│       │   ├── ai.py
│       │   └── health.py
│       ├── services/
│       │   ├── __init__.py
│       │   ├── auth_service.py       # Phase 2 - DONE
│       │   ├── case_service.py
│       │   ├── storage_service.py
│       │   ├── paperless_service.py  # Phase 2 - DONE
│       │   ├── entity_service.py     # Phase 2 - DONE
│       │   ├── embedding_service.py  # Phase 2
│       │   ├── report_service.py     # Phase 2
│       │   ├── ollama_service.py
│       │   └── audit_service.py
│       └── utils/
│           ├── __init__.py
│           └── security.py        # Phase 2
│
├── frontend/                      # Phase 3
│   ├── Dockerfile
│   ├── nginx.conf
│   ├── package.json
│   └── src/
│
├── configs/
│   └── postgres/
│       ├── 00-create-paperless-db.sh  # Phase 2 - DONE
│       └── init.sql
│
├── templates/                     # Phase 2
│   └── reports/
│       ├── standard.docx
│       └── executive.docx
│
├── scripts/
│   ├── bootstrap.sh
│   ├── seed-data.sh
│   └── backup.sh
│
└── kb/                            # Knowledge base docs
    └── sample-policy.md
      ]]>
    </directory_structure>
  </architecture>

  <!-- ============================================== -->
  <!-- CASE ID SYSTEM                                 -->
  <!-- ============================================== -->
  <case_id_system>
    <format>SCOPE-TYPE-SEQ</format>
    <description>Human-readable, auto-generated case identifiers</description>
    <examples>
      <example>FIN-USB-0001 - Finance dept, USB exfiltration, first case</example>
      <example>HR-EMAIL-0003 - HR dept, Email incident, third case</example>
      <example>SEC-POLICY-0012 - Security dept, Policy violation, twelfth case</example>
    </examples>

    <scopes>
      <scope code="FIN" name="Finance">Financial operations, accounting, monetary transactions</scope>
      <scope code="HR" name="Human Resources">Employee data, HR processes, personnel</scope>
      <scope code="IT" name="Information Technology">IT systems, infrastructure, technical ops</scope>
      <scope code="SEC" name="Security">Physical and information security, access controls</scope>
      <scope code="OPS" name="Operations">Business operations, process management</scope>
      <scope code="CORP" name="Corporate">Corporate and executive matters</scope>
      <scope code="LEGAL" name="Legal">Legal compliance, contracts, regulatory</scope>
      <scope code="RND" name="Research &amp; Development">R&amp;D, innovation, product development</scope>
      <scope code="PRO" name="Procurement">Purchasing, vendor management, supply chain</scope>
      <scope code="MKT" name="Marketing">Marketing activities, campaigns, communications</scope>
      <scope code="QA" name="Quality Assurance">Quality control, testing, compliance verification</scope>
      <scope code="ENV" name="Environmental">Environmental compliance, sustainability</scope>
      <scope code="SAF" name="Health &amp; Safety">Workplace health and safety</scope>
      <scope code="EXT" name="External">External partnerships, third-party relationships</scope>
      <scope code="GOV" name="Governance">Corporate governance, board-level matters</scope>
      <scope code="GEN" name="General">General audits not fitting other categories</scope>
    </scopes>

    <types>
      <type code="USB">USB/removable media incidents</type>
      <type code="EMAIL">Email-related incidents</type>
      <type code="WEB">Web/internet-related incidents</type>
      <type code="POLICY">Policy violations</type>
    </types>

    <implementation>
      <![CDATA[
-- PostgreSQL function for ID generation
CREATE OR REPLACE FUNCTION generate_case_id(p_scope_code VARCHAR, p_case_type case_type)
RETURNS VARCHAR AS $$
DECLARE
    v_seq INTEGER;
    v_case_id VARCHAR;
BEGIN
    INSERT INTO case_sequences (scope_code, case_type, last_seq)
    VALUES (p_scope_code, p_case_type, 1)
    ON CONFLICT (scope_code, case_type)
    DO UPDATE SET last_seq = case_sequences.last_seq + 1
    RETURNING last_seq INTO v_seq;

    v_case_id := p_scope_code || '-' || p_case_type || '-' || LPAD(v_seq::TEXT, 4, '0');
    RETURN v_case_id;
END;
$$ LANGUAGE plpgsql;
      ]]>
    </implementation>
  </case_id_system>

  <!-- ============================================== -->
  <!-- PHASE 1: CORE PLATFORM (MVP) - COMPLETED       -->
  <!-- ============================================== -->
  <phase number="1" name="Core Platform" status="COMPLETED">
    <description>Foundational case management system with basic AI integration</description>
    <completion_date>2026-01-14</completion_date>

    <feature_group name="Infrastructure">
      <feature id="1.1" status="COMPLETED">
        <name>Docker Compose Setup</name>
        <description>Multi-service orchestration with PostgreSQL, MinIO, Ollama, API</description>
        <files>
          <file>docker-compose.yml</file>
          <file>.env.example</file>
        </files>
      </feature>
      <feature id="1.2" status="COMPLETED">
        <name>PostgreSQL with pgvector</name>
        <description>Database schema with vector extension for embeddings</description>
        <files>
          <file>configs/postgres/init.sql</file>
        </files>
        <tables>
          <table>users</table>
          <table>scopes</table>
          <table>cases</table>
          <table>case_sequences</table>
          <table>evidence</table>
          <table>findings</table>
          <table>timeline_events</table>
          <table>audit_log</table>
          <table>embeddings</table>
        </tables>
      </feature>
      <feature id="1.3" status="COMPLETED">
        <name>MinIO Evidence Storage</name>
        <description>S3-compatible object storage for evidence files</description>
        <bucket>evidence</bucket>
        <path_format>cases/{case_id}/{filename}</path_format>
      </feature>
      <feature id="1.4" status="COMPLETED">
        <name>Ollama Integration</name>
        <description>Local LLM service for AI features</description>
        <default_model>llama3.2</default_model>
      </feature>
    </feature_group>

    <feature_group name="API Backend">
      <feature id="1.5" status="COMPLETED">
        <name>FastAPI Application</name>
        <description>Core API framework with CORS, health checks, lifespan management</description>
        <files>
          <file>api/app/main.py</file>
          <file>api/app/config.py</file>
          <file>api/app/database.py</file>
          <file>api/Dockerfile</file>
          <file>api/requirements.txt</file>
        </files>
      </feature>
      <feature id="1.6" status="COMPLETED">
        <name>SQLAlchemy Models</name>
        <description>ORM models for all database entities</description>
        <files>
          <file>api/app/models/__init__.py</file>
          <file>api/app/models/base.py</file>
          <file>api/app/models/user.py</file>
          <file>api/app/models/scope.py</file>
          <file>api/app/models/case.py</file>
          <file>api/app/models/evidence.py</file>
          <file>api/app/models/finding.py</file>
          <file>api/app/models/audit_log.py</file>
        </files>
      </feature>
      <feature id="1.7" status="COMPLETED">
        <name>Pydantic Schemas</name>
        <description>Request/response validation schemas</description>
        <files>
          <file>api/app/schemas/__init__.py</file>
          <file>api/app/schemas/common.py</file>
          <file>api/app/schemas/user.py</file>
          <file>api/app/schemas/case.py</file>
          <file>api/app/schemas/evidence.py</file>
          <file>api/app/schemas/finding.py</file>
          <file>api/app/schemas/report.py</file>
        </files>
      </feature>
      <feature id="1.8" status="COMPLETED">
        <name>API Routers</name>
        <description>REST endpoints for all resources</description>
        <files>
          <file>api/app/routers/__init__.py</file>
          <file>api/app/routers/cases.py</file>
          <file>api/app/routers/evidence.py</file>
          <file>api/app/routers/users.py</file>
          <file>api/app/routers/scopes.py</file>
          <file>api/app/routers/ai.py</file>
          <file>api/app/routers/health.py</file>
        </files>
      </feature>
      <feature id="1.9" status="COMPLETED">
        <name>Service Layer</name>
        <description>Business logic services</description>
        <files>
          <file>api/app/services/__init__.py</file>
          <file>api/app/services/case_service.py</file>
          <file>api/app/services/storage_service.py</file>
          <file>api/app/services/ollama_service.py</file>
          <file>api/app/services/audit_service.py</file>
        </files>
      </feature>
      <feature id="1.10" status="COMPLETED">
        <name>Case ID Generation</name>
        <description>Auto-generate SCOPE-TYPE-SEQ format IDs</description>
        <implementation>PostgreSQL function + Python service</implementation>
      </feature>
    </feature_group>

    <feature_group name="Documentation">
      <feature id="1.11" status="COMPLETED">
        <name>README</name>
        <description>Project documentation with setup instructions</description>
        <files>
          <file>README.md</file>
        </files>
      </feature>
      <feature id="1.12" status="COMPLETED">
        <name>Bootstrap Script</name>
        <description>Initial setup automation</description>
        <files>
          <file>scripts/bootstrap.sh</file>
        </files>
      </feature>
    </feature_group>

    <known_limitations>
      <limitation resolved="true" resolved_in="2.2">Authentication/authorization - RESOLVED in Feature 2.2</limitation>
      <limitation>AI summarize/similar endpoints are stubs (pending Feature 2.9/2.10)</limitation>
    </known_limitations>
  </phase>

  <!-- ============================================== -->
  <!-- PHASE 2: DOCUMENT INTELLIGENCE - IN PROGRESS   -->
  <!-- ============================================== -->
  <phase number="2" name="Document Intelligence" status="COMPLETED">
    <description>OCR, entity extraction, real RAG implementation, and report generation</description>

    <feature_group name="Database Integration">
      <feature id="2.1" status="COMPLETED">
        <name>Complete Database CRUD</name>
        <description>Wire up all API endpoints to actual database operations</description>
        <priority>1</priority>
        <completion_date>2026-01-14</completion_date>
        <tasks>
          <task status="done">Implement case creation with DB persistence</task>
          <task status="done">Implement case listing with filters and pagination</task>
          <task status="done">Implement case updates and soft deletes</task>
          <task status="done">Implement evidence metadata storage with MinIO</task>
          <task status="done">Implement findings CRUD</task>
          <task status="done">Implement timeline events CRUD</task>
          <task status="done">Implement audit logging for all operations</task>
        </tasks>
        <files_modified>
          <file>api/app/routers/cases.py</file>
          <file>api/app/routers/evidence.py</file>
          <file>api/app/services/case_service.py</file>
          <file>api/app/services/audit_service.py</file>
          <file>configs/postgres/init.sql</file>
        </files_modified>
      </feature>
      <feature id="2.2" status="COMPLETED">
        <name>User Authentication</name>
        <description>JWT-based authentication system</description>
        <priority>2</priority>
        <completion_date>2026-01-14</completion_date>
        <tasks>
          <task status="done">Add password hashing (bcrypt)</task>
          <task status="done">Implement login endpoint with JWT token generation</task>
          <task status="done">Add JWT middleware for protected routes</task>
          <task status="done">Implement role-based access control</task>
        </tasks>
        <files_created>
          <file>api/app/routers/auth.py</file>
          <file>api/app/services/auth_service.py</file>
          <file>api/app/utils/security.py</file>
        </files_created>
        <files_modified>
          <file>api/app/config.py</file>
          <file>api/app/main.py</file>
          <file>api/app/routers/cases.py</file>
          <file>api/app/routers/evidence.py</file>
          <file>api/requirements.txt</file>
          <file>configs/postgres/init.sql</file>
        </files_modified>
        <dependencies>
          <dependency>python-jose[cryptography]</dependency>
          <dependency>passlib[bcrypt]</dependency>
          <dependency>bcrypt==4.0.1</dependency>
        </dependencies>
        <endpoints>
          <endpoint method="POST" path="/api/v1/auth/login">User login with JWT token</endpoint>
          <endpoint method="POST" path="/api/v1/auth/register">User registration (admin only)</endpoint>
          <endpoint method="GET" path="/api/v1/auth/me">Get current user profile</endpoint>
        </endpoints>
      </feature>
    </feature_group>

    <feature_group name="Paperless-ngx Integration">
      <feature id="2.3" status="COMPLETED">
        <name>Paperless Service Setup</name>
        <description>Add Paperless-ngx to Docker Compose for OCR</description>
        <priority>3</priority>
        <completion_date>2026-01-14</completion_date>
        <tasks>
          <task status="done">Add paperless service to docker-compose.yml</task>
          <task status="done">Add Redis service for Paperless task queue</task>
          <task status="done">Configure shared storage with API service</task>
          <task status="done">Set up Paperless API credentials</task>
          <task status="done">Create separate PostgreSQL database for Paperless</task>
        </tasks>
        <files_created>
          <file>configs/postgres/00-create-paperless-db.sh</file>
        </files_created>
        <files_modified>
          <file>docker-compose.yml</file>
          <file>.env.example</file>
        </files_modified>
        <docker_config>
          <image>ghcr.io/paperless-ngx/paperless-ngx:latest</image>
          <port>18080</port>
          <depends_on>postgres, redis</depends_on>
        </docker_config>
      </feature>
      <feature id="2.4" status="COMPLETED">
        <name>Paperless Connector</name>
        <description>API service to interact with Paperless</description>
        <priority>3</priority>
        <completion_date>2026-01-14</completion_date>
        <tasks>
          <task status="done">Create api/app/services/paperless_service.py</task>
          <task status="done">Implement document upload to Paperless</task>
          <task status="done">Implement OCR text retrieval</task>
          <task status="done">Implement document search</task>
          <task status="done">Implement tag management for case organization</task>
          <task status="done">Implement health check endpoint</task>
        </tasks>
        <files_created>
          <file>api/app/services/paperless_service.py</file>
        </files_created>
        <files_modified>
          <file>api/app/services/__init__.py</file>
          <file>api/app/config.py</file>
        </files_modified>
        <service_methods>
          <method>upload_document() - Upload file to Paperless for OCR</method>
          <method>get_document() - Get document with OCR text</method>
          <method>get_document_content() - Get extracted text only</method>
          <method>search_documents() - Full-text search</method>
          <method>get_or_create_tag() - Tag management</method>
          <method>health_check() - Connection status</method>
        </service_methods>
      </feature>
      <feature id="2.5" status="COMPLETED">
        <name>Evidence Sync Pipeline</name>
        <description>Auto-sync evidence files to Paperless for OCR</description>
        <priority>3</priority>
        <completion_date>2026-01-14</completion_date>
        <tested>true</tested>
        <tasks>
          <task status="done">Create sync endpoint POST /api/v1/sync/case/{case_id}</task>
          <task status="done">List evidence files from MinIO</task>
          <task status="done">Send PDFs/images to Paperless</task>
          <task status="done">Retrieve OCR text and store in evidence.extracted_text</task>
          <task status="pending">Trigger embedding generation (moved to Feature 2.8)</task>
        </tasks>
        <files_created>
          <file>api/app/routers/sync.py</file>
        </files_created>
        <files_modified>
          <file>api/app/routers/__init__.py</file>
          <file>api/app/main.py</file>
        </files_modified>
        <supported_file_types>
          <type>application/pdf</type>
          <type>image/png, image/jpeg, image/gif, image/tiff</type>
          <type>text/plain</type>
          <type>application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document</type>
        </supported_file_types>
        <endpoints>
          <endpoint method="GET" path="/api/v1/sync/status">Check Paperless connection status</endpoint>
          <endpoint method="POST" path="/api/v1/sync/case/{case_id}">Sync all case evidence to Paperless</endpoint>
          <endpoint method="POST" path="/api/v1/sync/evidence/{evidence_id}">Sync single evidence file</endpoint>
          <endpoint method="POST" path="/api/v1/sync/evidence/{evidence_id}/extract">Extract OCR text from Paperless doc</endpoint>
          <endpoint method="GET" path="/api/v1/sync/paperless/search">Search Paperless documents</endpoint>
        </endpoints>
      </feature>
    </feature_group>

    <feature_group name="Entity Extraction">
      <feature id="2.6" status="COMPLETED">
        <name>Entity Extraction Service</name>
        <description>Extract structured entities from evidence text</description>
        <priority>4</priority>
        <tasks>
          <task status="done">Create api/app/services/entity_service.py</task>
          <task status="done">Implement regex patterns for employee IDs (EMP-[0-9]{6})</task>
          <task status="done">Implement hostname/computer name detection</task>
          <task status="done">Implement IP address extraction</task>
          <task status="done">Implement email address extraction</task>
          <task status="done">Implement MAC address extraction</task>
          <task status="done">Implement USB device identifier extraction</task>
        </tasks>
        <files_created>
          <file>api/app/services/entity_service.py</file>
        </files_created>
        <entity_patterns>
          <pattern name="employee_id" regex="\bEMP[-_]?\d{4,8}\b"/>
          <pattern name="ip_address" regex="IPv4 and IPv6 addresses"/>
          <pattern name="email" regex="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"/>
          <pattern name="hostname" regex="WS|PC|DESKTOP|LAPTOP|SRV|SERVER patterns"/>
          <pattern name="mac_address" regex="MAC address formats"/>
          <pattern name="usb_device" regex="USB device identifiers"/>
        </entity_patterns>
        <service_methods>
          <method>extract_entities(text, entity_types) - Extract from text</method>
          <method>extract_all_entities(text) - Extract all as flat list</method>
          <method>store_entities(db, case_id, evidence_id, entities, source) - Store to DB</method>
          <method>get_case_entities(db, case_id, entity_type, skip, limit) - Get entities</method>
          <method>search_entities(db, value_pattern, entity_type, limit) - Search across cases</method>
          <method>get_entity_summary(db, case_id) - Get counts by type</method>
          <method>extract_and_store_from_evidence(db, case_id, evidence_id, text, source)</method>
        </service_methods>
        <tested>true</tested>
      </feature>
      <feature id="2.7" status="COMPLETED">
        <name>Entity Storage</name>
        <description>Store and query extracted entities</description>
        <priority>4</priority>
        <tasks>
          <task status="done">Create case_entities table in init.sql</task>
          <task status="done">Create entity schemas</task>
          <task status="done">Implement entity router with search endpoints</task>
          <task status="done">Register router in main.py</task>
          <task status="done">Update services/__init__.py</task>
          <task status="done">Update routers/__init__.py</task>
        </tasks>
        <files_created>
          <file>api/app/schemas/entity.py</file>
          <file>api/app/routers/entities.py</file>
        </files_created>
        <files_modified>
          <file>configs/postgres/init.sql - Added case_entities table</file>
          <file>api/app/main.py - Added entities router</file>
          <file>api/app/services/__init__.py - Added EntityService</file>
          <file>api/app/routers/__init__.py - Added entities_router</file>
        </files_modified>
        <new_endpoints>
          <endpoint method="POST" path="/api/v1/entities/extract">Extract entities from text (no storage)</endpoint>
          <endpoint method="POST" path="/api/v1/entities/store">Extract and store entities for case</endpoint>
          <endpoint method="GET" path="/api/v1/entities/case/{case_id}">List entities for case (paginated)</endpoint>
          <endpoint method="GET" path="/api/v1/entities/case/{case_id}/summary">Get entity counts by type</endpoint>
          <endpoint method="GET" path="/api/v1/entities/search">Search cases by entity value</endpoint>
        </new_endpoints>
        <database_table>
          <name>case_entities</name>
          <columns>id, case_id, evidence_ids[], entity_type, value, source, occurrence_count, metadata, created_at, updated_at</columns>
          <unique_constraint>case_id, entity_type, value</unique_constraint>
        </database_table>
        <tested>true</tested>
      </feature>
      </feature>
    </feature_group>

    <feature_group name="RAG Implementation">
      <feature id="2.8" status="COMPLETED">
        <name>Embedding Service</name>
        <description>Generate and store vector embeddings using Ollama</description>
        <priority>5</priority>
        <tasks>
          <task>Create api/app/services/embedding_service.py</task>
          <task>Implement text chunking for long documents</task>
          <task>Call Ollama embedding API</task>
          <task>Store embeddings in pgvector</task>
          <task>Implement batch embedding for case sync</task>
        </tasks>
        <files_to_create>
          <file>api/app/services/embedding_service.py</file>
        </files_to_create>
        <embedding_config>
          <model>nomic-embed-text</model>
          <dimension>768</dimension>
        </embedding_config>
      </feature>
      <feature id="2.9" status="COMPLETED">
        <name>Similarity Search</name>
        <description>Real vector similarity search for cases</description>
        <priority>5</priority>
        <completion_date>2026-01-15</completion_date>
        <tasks>
          <task status="done">Implement cosine similarity query in pgvector</task>
          <task status="done">Update /api/v1/ai/similar/{case_id} to use real embeddings</task>
          <task status="done">Return matching cases with similarity scores</task>
          <task status="done">Add filters (same scope, include closed, min similarity)</task>
        </tasks>
        <files_modified>
          <file>api/app/routers/ai.py</file>
        </files_modified>
        <endpoints>
          <endpoint method="GET" path="/api/v1/ai/similar-cases/{case_id}">Find similar cases (query params)</endpoint>
          <endpoint method="POST" path="/api/v1/ai/similar/{case_id}">Find similar cases (request body)</endpoint>
        </endpoints>
        <tested>true</tested>
      </feature>
      <feature id="2.10" status="COMPLETED">
        <name>AI Case Summarization</name>
        <description>Real AI summarization using Ollama</description>
        <priority>5</priority>
        <completion_date>2026-01-15</completion_date>
        <tasks>
          <task status="done">Build case context from DB (title, description, findings, timeline)</task>
          <task status="done">Create summarization prompt template</task>
          <task status="done">Call Ollama generate API</task>
          <task status="done">Parse structured response (summary, key points, risk, recommendations)</task>
          <task status="done">Update /api/v1/ai/summarize/{case_id} endpoint</task>
        </tasks>
        <files_modified>
          <file>api/app/routers/ai.py</file>
          <file>api/app/services/ollama_service.py</file>
          <file>api/app/services/case_service.py</file>
        </files_modified>
        <service_methods>
          <method>summarize_case_structured() - Generate structured summary with key_points, risk_assessment, recommendations</method>
          <method>_parse_structured_summary() - Parse LLM response into structured dictionary</method>
          <method>get_case_findings() - Fetch findings from DB for context</method>
          <method>get_case_timeline() - Fetch timeline events for context</method>
        </service_methods>
        <tested>true</tested>
      </feature>
    </feature_group>

    <feature_group name="Report Generation">
      <feature id="2.11" status="COMPLETED">
        <name>DOCX Report Generator</name>
        <description>Generate Word documents from case data</description>
        <priority>6</priority>
        <completion_date>2026-01-15</completion_date>
        <tasks>
          <task status="done">Create api/app/services/report_service.py</task>
          <task status="done">Create DOCX template structure</task>
          <task status="done">Implement executive summary section</task>
          <task status="done">Implement case details section</task>
          <task status="done">Implement timeline section</task>
          <task status="done">Implement findings section with severity</task>
          <task status="done">Implement evidence list with hashes</task>
          <task status="done">Implement similar cases appendix</task>
          <task status="done">Implement recommendations section (via AI summary)</task>
        </tasks>
        <files_created>
          <file>api/app/services/report_service.py</file>
          <file>api/app/routers/reports.py</file>
        </files_created>
        <files_modified>
          <file>api/app/main.py</file>
          <file>api/app/routers/__init__.py</file>
          <file>api/app/services/__init__.py</file>
        </files_modified>
        <new_endpoints>
          <endpoint method="GET" path="/api/v1/reports/case/{case_id}.docx">Generate DOCX report</endpoint>
          <endpoint method="GET" path="/api/v1/reports/templates">List available templates</endpoint>
          <endpoint method="GET" path="/api/v1/reports/health">Report service health check</endpoint>
        </new_endpoints>
        <service_methods>
          <method>generate_report() - Main report generation with template selection</method>
          <method>_add_cover_page() - Cover page with case ID and classification</method>
          <method>_add_executive_summary() - AI-generated executive summary</method>
          <method>_add_case_details() - Full case metadata table</method>
          <method>_add_timeline() - Chronological event listing</method>
          <method>_add_findings() - Severity-sorted findings</method>
          <method>_add_evidence_list() - Evidence with file hashes</method>
          <method>_add_similar_cases() - Related cases appendix</method>
          <method>_add_entities_appendix() - Extracted entities list</method>
        </service_methods>
        <tested>true</tested>
      </feature>
      <feature id="2.12" status="COMPLETED">
        <name>Report Templates</name>
        <description>Configurable report templates</description>
        <priority>6</priority>
        <completion_date>2026-01-15</completion_date>
        <tasks>
          <task status="done">Implement STANDARD template (programmatic)</task>
          <task status="done">Implement EXECUTIVE_SUMMARY template</task>
          <task status="done">Implement DETAILED template with entities appendix</task>
          <task status="done">Implement COMPLIANCE template</task>
        </tasks>
        <templates>
          <template name="STANDARD">Full case report with all sections</template>
          <template name="EXECUTIVE_SUMMARY">Brief overview for management</template>
          <template name="DETAILED">Comprehensive investigation report</template>
          <template name="COMPLIANCE">Regulatory compliance focused</template>
        </templates>
        <note>Templates implemented programmatically in report_service.py rather than as separate DOCX files for maximum flexibility</note>
        <tested>true</tested>
      </feature>
    </feature_group>
  </phase>

  <!-- ============================================== -->
  <!-- PHASE 3: FRONTEND & COLLABORATION - PENDING    -->
  <!-- ============================================== -->
  <phase number="3" name="Frontend and Collaboration" status="IN_PROGRESS">
    <description>React frontend, real-time collaboration, advanced analytics</description>

    <feature_group name="React Frontend">
      <feature id="3.1" status="COMPLETED">
        <name>Frontend Setup</name>
        <description>React application with Vite, TypeScript, TailwindCSS</description>
        <completion_date>2026-01-15</completion_date>
        <tech_stack>
          <framework>React 18</framework>
          <bundler>Vite</bundler>
          <language>TypeScript</language>
          <styling>TailwindCSS</styling>
          <state>React Query + Context</state>
          <routing>React Router v6</routing>
        </tech_stack>
        <files_created>
          <file>frontend/package.json</file>
          <file>frontend/vite.config.ts</file>
          <file>frontend/tsconfig.json</file>
          <file>frontend/tailwind.config.js</file>
          <file>frontend/index.html</file>
          <file>frontend/Dockerfile</file>
          <file>frontend/nginx.conf</file>
          <file>frontend/src/main.tsx</file>
          <file>frontend/src/App.tsx</file>
          <file>frontend/src/types/index.ts</file>
          <file>frontend/src/services/api.ts</file>
          <file>frontend/src/context/AuthContext.tsx</file>
          <file>frontend/src/hooks/useAuth.ts</file>
          <file>frontend/src/components/layout/*</file>
          <file>frontend/src/components/common/*</file>
        </files_created>
        <files_modified>
          <file>docker-compose.yml - Added frontend service</file>
        </files_modified>
        <tested>true</tested>
      </feature>
      <feature id="3.2" status="COMPLETED">
        <name>Dashboard Page</name>
        <description>Main dashboard with case overview and statistics</description>
        <completion_date>2026-01-15</completion_date>
        <files_created>
          <file>frontend/src/pages/Dashboard.tsx</file>
        </files_created>
        <features>
          <feature>Case statistics (total, open, in progress, closed)</feature>
          <feature>Recent cases list</feature>
          <feature>Critical cases requiring attention</feature>
        </features>
        <tested>true</tested>
      </feature>
      <feature id="3.3" status="COMPLETED">
        <name>Case List Page</name>
        <description>Searchable, filterable case list</description>
        <completion_date>2026-01-15</completion_date>
        <files_created>
          <file>frontend/src/pages/CaseList.tsx</file>
          <file>frontend/src/pages/CaseDetail.tsx</file>
          <file>frontend/src/pages/CaseCreate.tsx</file>
          <file>frontend/src/pages/Login.tsx</file>
        </files_created>
        <features>
          <feature>Search by title and case number</feature>
          <feature>Filter by status and severity</feature>
          <feature>Sortable table view</feature>
          <feature>Case detail with tabs (overview, evidence, findings, timeline)</feature>
          <feature>Create new case form</feature>
        </features>
        <tested>true</tested>
      </feature>
      <feature id="3.4" status="COMPLETED">
        <name>Case Detail Page Enhancements</name>
        <description>Full case view with AI Analysis tab and report generation</description>
        <completion_date>2026-01-15</completion_date>
        <files_modified>
          <file>frontend/src/pages/CaseDetail.tsx</file>
        </files_modified>
        <features>
          <feature>AI Analysis tab with summary, key points, risk assessment, recommendations</feature>
          <feature>Report generation with 4 template options (Standard, Executive, Detailed, Compliance)</feature>
          <feature>Evidence upload functionality with description</feature>
          <feature>Enhanced overview with Summary and Description cards</feature>
          <feature>Subject details card (user, computer)</feature>
          <feature>Statistics card (evidence count, findings count)</feature>
          <feature>Tags display</feature>
        </features>
        <tested>true</tested>
      </feature>
      <feature id="3.5" status="COMPLETED">
        <name>Case Create/Edit Form</name>
        <description>Form for creating and editing cases with validation</description>
        <completion_date>2026-01-15</completion_date>
        <files_modified>
          <file>frontend/src/pages/CaseCreate.tsx</file>
        </files_modified>
        <features>
          <feature>All required fields (title, summary, scope, type, severity)</feature>
          <feature>Client-side validation (min length for title/summary)</feature>
          <feature>Tags input (comma-separated)</feature>
          <feature>Custom metadata JSON field</feature>
          <feature>Scope dropdown with all 15 scopes</feature>
        </features>
        <tested>true</tested>
      </feature>
      <feature id="3.6" status="COMPLETED">
        <name>Reports Page</name>
        <description>Dedicated page for report generation</description>
        <completion_date>2026-01-15</completion_date>
        <files_created>
          <file>frontend/src/pages/Reports.tsx</file>
        </files_created>
        <files_modified>
          <file>frontend/src/App.tsx - Added route</file>
        </files_modified>
        <features>
          <feature>Template selection cards (Standard, Executive, Detailed, Compliance)</feature>
          <feature>Case search and filtering</feature>
          <feature>Case list with status, severity, stats</feature>
          <feature>One-click report generation per case</feature>
          <feature>Report information help section</feature>
        </features>
        <tested>true</tested>
      </feature>
      <feature id="3.7" status="COMPLETED">
        <name>Admin Pages</name>
        <description>User and system administration</description>
        <completion_date>2026-01-15</completion_date>
        <files_created>
          <file>frontend/src/pages/Admin.tsx</file>
        </files_created>
        <files_modified>
          <file>frontend/src/App.tsx - Added admin route</file>
          <file>frontend/src/services/api.ts - Added usersApi</file>
          <file>frontend/src/types/index.ts - Added user management types</file>
          <file>api/app/routers/auth.py - Added user CRUD endpoints</file>
          <file>api/app/services/auth_service.py - Added update/deactivate methods</file>
        </files_modified>
        <features>
          <feature>User listing with search and filter</feature>
          <feature>User creation with role assignment</feature>
          <feature>User profile editing</feature>
          <feature>User deactivation (soft delete)</feature>
          <feature>User statistics dashboard (total, active, by role)</feature>
          <feature>Admin-only access control</feature>
        </features>
        <api_endpoints>
          <endpoint method="GET" path="/api/v1/auth/users">List all users (paginated)</endpoint>
          <endpoint method="GET" path="/api/v1/auth/users/{user_id}">Get user by ID</endpoint>
          <endpoint method="PATCH" path="/api/v1/auth/users/{user_id}">Update user</endpoint>
          <endpoint method="DELETE" path="/api/v1/auth/users/{user_id}">Deactivate user</endpoint>
        </api_endpoints>
        <tested>true</tested>
      </feature>
    </feature_group>

    <feature_group name="Collaboration">
      <feature id="3.8" status="COMPLETED">
        <name>Nextcloud Integration</name>
        <description>File storage and collaboration platform with WebDAV</description>
        <completion_date>2026-01-15</completion_date>
        <files_created>
          <file>api/app/services/nextcloud_service.py</file>
          <file>api/app/routers/nextcloud.py</file>
          <file>configs/postgres/02-create-nextcloud-db.sh</file>
        </files_created>
        <files_modified>
          <file>docker-compose.yml - Added Nextcloud service</file>
          <file>.env.example - Added Nextcloud environment variables</file>
          <file>api/app/config.py - Added Nextcloud settings</file>
          <file>api/app/main.py - Registered nextcloud router</file>
          <file>api/app/routers/__init__.py - Added nextcloud_router</file>
          <file>api/app/services/__init__.py - Added NextcloudService</file>
          <file>api/app/routers/cases.py - Auto-create Nextcloud folder on case creation</file>
          <file>frontend/src/services/api.ts - Added nextcloudApi</file>
          <file>frontend/src/pages/CaseDetail.tsx - Added Nextcloud button</file>
        </files_modified>
        <features>
          <feature>Nextcloud Docker service with PostgreSQL database</feature>
          <feature>WebDAV-based file operations (create, upload, list, delete)</feature>
          <feature>Automatic case folder creation (AuditCases/{case_id}/Evidence|Reports|Notes)</feature>
          <feature>OCS API for share link creation</feature>
          <feature>Frontend "Open in Nextcloud" button on case detail page</feature>
        </features>
        <api_endpoints>
          <endpoint method="GET" path="/api/v1/nextcloud/health">Nextcloud health check</endpoint>
          <endpoint method="POST" path="/api/v1/nextcloud/folders">Create folder</endpoint>
          <endpoint method="POST" path="/api/v1/nextcloud/case/{case_id}/folder">Create case folder structure</endpoint>
          <endpoint method="GET" path="/api/v1/nextcloud/folders">List folder contents</endpoint>
          <endpoint method="GET" path="/api/v1/nextcloud/case/{case_id}/files">List case files</endpoint>
          <endpoint method="POST" path="/api/v1/nextcloud/case/{case_id}/upload">Upload to case folder</endpoint>
          <endpoint method="DELETE" path="/api/v1/nextcloud/files">Delete file/folder</endpoint>
          <endpoint method="POST" path="/api/v1/nextcloud/share">Create share link</endpoint>
          <endpoint method="GET" path="/api/v1/nextcloud/case/{case_id}/url">Get case folder URL</endpoint>
        </api_endpoints>
        <docker_config>
          <image>nextcloud:29-apache</image>
          <port>18081</port>
          <depends_on>postgres</depends_on>
        </docker_config>
        <tested>true</tested>
      </feature>
      <feature id="3.9" status="COMPLETED">
        <name>ONLYOFFICE Integration</name>
        <description>In-browser document editing via ONLYOFFICE Document Server</description>
        <completion_date>2026-01-15</completion_date>
        <files_created>
          <file>api/app/services/onlyoffice_service.py</file>
          <file>api/app/routers/onlyoffice.py</file>
          <file>scripts/test-onlyoffice.sh - 24 integration tests</file>
        </files_created>
        <files_modified>
          <file>docker-compose.yml - Added ONLYOFFICE Document Server service</file>
          <file>.env.example - Added ONLYOFFICE_JWT_SECRET</file>
          <file>api/app/config.py - Added ONLYOFFICE settings</file>
          <file>api/app/main.py - Registered onlyoffice router</file>
          <file>api/app/routers/__init__.py - Added onlyoffice_router</file>
          <file>api/app/services/__init__.py - Added OnlyOfficeService</file>
          <file>frontend/src/services/api.ts - Added onlyofficeApi</file>
          <file>frontend/src/pages/CaseDetail.tsx - Added Edit/View buttons for documents</file>
        </files_modified>
        <features>
          <feature>ONLYOFFICE Document Server (onlyoffice/documentserver) on port 18082</feature>
          <feature>JWT authentication between services</feature>
          <feature>Nextcloud ONLYOFFICE connector app integration</feature>
          <feature>Edit/View buttons on evidence items for supported file types</feature>
          <feature>Document type detection (word, cell, slide)</feature>
          <feature>Editable formats: .docx, .xlsx, .pptx, .odt, .ods, .odp</feature>
          <feature>Viewable formats: .pdf, .doc, .xls, .ppt, .txt, .rtf, .csv, .html</feature>
        </features>
        <api_endpoints>
          <endpoint method="GET" path="/api/v1/onlyoffice/health">ONLYOFFICE health check</endpoint>
          <endpoint method="GET" path="/api/v1/onlyoffice/extensions">Supported file extensions</endpoint>
          <endpoint method="GET" path="/api/v1/onlyoffice/editor-url">ONLYOFFICE editor base URL</endpoint>
          <endpoint method="GET" path="/api/v1/onlyoffice/edit-url">Get Nextcloud edit URL for file</endpoint>
          <endpoint method="GET" path="/api/v1/onlyoffice/case/{case_id}/documents">List editable case documents</endpoint>
        </api_endpoints>
        <docker_config>
          <image>onlyoffice/documentserver:latest</image>
          <port>18082</port>
          <jwt_enabled>true</jwt_enabled>
        </docker_config>
        <test_script>scripts/test-onlyoffice.sh (24 tests)</test_script>
        <tested>true</tested>
      </feature>
      <feature id="3.10" status="PENDING">
        <name>Real-time Updates</name>
        <description>WebSocket-based live updates</description>
      </feature>
    </feature_group>

    <feature_group name="Advanced Features">
      <feature id="3.11" status="PENDING">
        <name>Analytics Dashboard</name>
        <description>Visual analytics and reporting</description>
      </feature>
      <feature id="3.12" status="PENDING">
        <name>Workflow Automation</name>
        <description>Automated case state transitions and notifications</description>
      </feature>
      <feature id="3.13" status="PENDING">
        <name>Advanced Search</name>
        <description>Full-text and semantic search across all content</description>
      </feature>
      <feature id="3.14" status="COMPLETED">
        <name>Evidence-Nextcloud Bidirectional Sync</name>
        <description>Automatic sync between MinIO evidence storage and Nextcloud collaboration folders</description>
        <completion_date>2026-01-15</completion_date>
        <files_created>
          <file>scripts/test-evidence-sync.sh - Comprehensive 24-test suite for sync</file>
        </files_created>
        <files_modified>
          <file>api/app/routers/evidence.py - Added sync endpoints and auto-sync on upload</file>
          <file>api/app/routers/nextcloud.py - Added files field to list responses</file>
        </files_modified>
        <features>
          <feature>Evidence auto-sync to Nextcloud on upload</feature>
          <feature>Manual sync endpoint: POST /evidence/cases/{case_id}/sync-to-nextcloud</feature>
          <feature>Import from Nextcloud: POST /evidence/cases/{case_id}/import-from-nextcloud</feature>
          <feature>Files uploaded to Nextcloud can be imported as evidence</feature>
          <feature>Skip already-imported files (deduplication)</feature>
          <feature>Audit logging for imported evidence</feature>
        </features>
        <api_endpoints>
          <endpoint method="POST" path="/api/v1/evidence/cases/{case_id}/sync-to-nextcloud">Sync all evidence to Nextcloud</endpoint>
          <endpoint method="POST" path="/api/v1/evidence/cases/{case_id}/import-from-nextcloud">Import files from Nextcloud</endpoint>
        </api_endpoints>
        <test_script>scripts/test-evidence-sync.sh (24 tests)</test_script>
        <tested>true</tested>
      </feature>
    </feature_group>
  </phase>

  <!-- ============================================== -->
  <!-- PROGRESS TRACKING                              -->
  <!-- ============================================== -->
  <progress>
    <summary>
      <total_features>38</total_features>
      <completed>34</completed>
      <in_progress>0</in_progress>
      <pending>4</pending>
      <completion_percentage>89</completion_percentage>
    </summary>

    <phase_status>
      <phase number="1" features_total="12" features_completed="12" status="COMPLETED"/>
      <phase number="2" features_total="12" features_completed="12" status="COMPLETED"/>
      <phase number="3" features_total="14" features_completed="10" status="IN_PROGRESS"/>
    </phase_status>

    <next_steps>
      <step priority="1" feature_id="3.10">Real-time Updates (WebSocket)</step>
      <step priority="2" feature_id="3.11">Analytics Dashboard</step>
      <step priority="3" feature_id="3.12">Workflow Automation</step>
    </next_steps>
  </progress>

  <!-- ============================================== -->
  <!-- CHANGELOG                                      -->
  <!-- ============================================== -->
  <changelog>
    <entry date="2026-01-15" version="0.4.6" phase="3">
      <changes>
        <change type="added">Feature 3.9: ONLYOFFICE Integration for in-browser document editing</change>
        <change type="added">ONLYOFFICE Document Server service (onlyoffice/documentserver) on port 18082</change>
        <change type="added">JWT authentication between ONLYOFFICE, Nextcloud, and API</change>
        <change type="added">Nextcloud ONLYOFFICE connector app auto-configuration</change>
        <change type="added">GET /api/v1/onlyoffice/health - ONLYOFFICE health check</change>
        <change type="added">GET /api/v1/onlyoffice/extensions - Supported file extensions</change>
        <change type="added">GET /api/v1/onlyoffice/edit-url - Get Nextcloud edit URL for documents</change>
        <change type="added">GET /api/v1/onlyoffice/case/{case_id}/documents - List editable case documents</change>
        <change type="added">Edit/View buttons on evidence items in Case Detail page</change>
        <change type="added">Document type detection (word, cell, slide)</change>
        <change type="added">Support for .docx, .xlsx, .pptx, .odt, .ods, .odp (editable)</change>
        <change type="added">Support for .pdf, .doc, .xls, .ppt, .txt, .rtf, .csv (viewable)</change>
        <change type="added">scripts/test-onlyoffice.sh - 24 integration tests</change>
        <change type="milestone">ONLYOFFICE integration complete - 67 total tests pass (43 + 24)</change>
      </changes>
    </entry>
    <entry date="2026-01-15" version="0.4.5" phase="3">
      <changes>
        <change type="added">Feature 3.14: Evidence-Nextcloud Bidirectional Sync</change>
        <change type="added">Auto-sync evidence to Nextcloud on upload</change>
        <change type="added">POST /api/v1/evidence/cases/{case_id}/sync-to-nextcloud - Manual sync all evidence</change>
        <change type="added">POST /api/v1/evidence/cases/{case_id}/import-from-nextcloud - Import from Nextcloud</change>
        <change type="added">scripts/test-evidence-sync.sh - Comprehensive 24-test sync test suite</change>
        <change type="added">Files uploaded directly to Nextcloud can be imported as evidence</change>
        <change type="added">Deduplication - skips already-imported files</change>
        <change type="added">Audit logging for all imported evidence</change>
        <change type="fixed">Evidence now syncs to Nextcloud Evidence folder automatically</change>
        <change type="milestone">Evidence-Nextcloud bidirectional sync complete - 43 total tests pass</change>
      </changes>
    </entry>
    <entry date="2026-01-15" version="0.4.3" phase="3">
      <changes>
        <change type="added">Feature 3.8: Nextcloud Integration for file collaboration</change>
        <change type="added">Nextcloud Docker service (nextcloud:29-apache) on port 18081</change>
        <change type="added">WebDAV-based file operations (create, upload, list, delete)</change>
        <change type="added">Automatic case folder creation on case creation</change>
        <change type="added">Case folder structure: AuditCases/{case_id}/Evidence|Reports|Notes</change>
        <change type="added">GET /api/v1/nextcloud/health - Nextcloud health check</change>
        <change type="added">POST /api/v1/nextcloud/case/{case_id}/folder - Create case folders</change>
        <change type="added">GET /api/v1/nextcloud/case/{case_id}/files - List case files</change>
        <change type="added">POST /api/v1/nextcloud/case/{case_id}/upload - Upload to case</change>
        <change type="added">GET /api/v1/nextcloud/case/{case_id}/url - Get case folder URL</change>
        <change type="added">POST /api/v1/nextcloud/share - Create share links (OCS API)</change>
        <change type="added">"Open in Nextcloud" button on Case Detail page</change>
        <change type="added">nextcloudApi in frontend services</change>
        <change type="milestone">Phase 3 progress: 8/13 features complete (62%)</change>
      </changes>
    </entry>
    <entry date="2026-01-15" version="0.4.2" phase="3">
      <changes>
        <change type="added">Feature 3.7: Admin Pages with user management</change>
        <change type="added">Admin dashboard with user statistics (total, active, by role)</change>
        <change type="added">User listing with search functionality</change>
        <change type="added">User creation form with role and department assignment</change>
        <change type="added">User profile editing (email, name, role, department)</change>
        <change type="added">User deactivation (soft delete) with protection against self-deactivation</change>
        <change type="added">GET /api/v1/auth/users - List users (paginated)</change>
        <change type="added">GET /api/v1/auth/users/{id} - Get user by ID</change>
        <change type="added">PATCH /api/v1/auth/users/{id} - Update user</change>
        <change type="added">DELETE /api/v1/auth/users/{id} - Deactivate user</change>
        <change type="added">usersApi in frontend for admin operations</change>
        <change type="milestone">Phase 3 progress: 7/13 features complete (54%)</change>
      </changes>
    </entry>
    <entry date="2026-01-15" version="0.4.1" phase="3">
      <changes>
        <change type="added">Feature 3.4: Case Detail Page Enhancements with AI Analysis tab</change>
        <change type="added">Feature 3.5: Case Create/Edit Form improvements with validation</change>
        <change type="added">Feature 3.6: Reports Page with template selection and one-click generation</change>
        <change type="added">AI Analysis tab showing summary, key points, risk assessment, recommendations</change>
        <change type="added">Report generation from Case Detail page with 4 templates</change>
        <change type="added">Evidence upload functionality with description</change>
        <change type="added">Reports page route (/reports)</change>
        <change type="fixed">Fixed 400 error on case creation - added missing scopes to database</change>
        <change type="fixed">Fixed TypeScript build errors (unused imports)</change>
        <change type="milestone">Phase 3 progress: 6/13 features complete (46%)</change>
      </changes>
    </entry>
    <entry date="2026-01-15" version="0.4.0" phase="3">
      <changes>
        <change type="added">Feature 3.1: React Frontend Setup with Vite, TypeScript, TailwindCSS</change>
        <change type="added">Feature 3.2: Dashboard Page with case statistics and recent cases</change>
        <change type="added">Feature 3.3: Case List Page with search and filtering</change>
        <change type="added">Login page with JWT authentication</change>
        <change type="added">Case Detail page with tabs (overview, evidence, findings, timeline)</change>
        <change type="added">Case Create form with severity/status selection</change>
        <change type="added">React Query for server state management</change>
        <change type="added">Axios API client with auth interceptors</change>
        <change type="added">AuthContext for authentication state</change>
        <change type="added">Reusable components (Button, Badge, Card, Layout)</change>
        <change type="added">Nginx reverse proxy for API requests</change>
        <change type="added">Multi-stage Docker build for frontend</change>
        <change type="added">Frontend service at http://localhost:13000</change>
        <change type="milestone">Phase 3 Started - Frontend foundations complete</change>
      </changes>
    </entry>
    <entry date="2026-01-15" version="0.3.0" phase="2">
      <changes>
        <change type="added">Feature 2.11: DOCX Report Generator with python-docx</change>
        <change type="added">Feature 2.12: Four report templates (STANDARD, EXECUTIVE_SUMMARY, DETAILED, COMPLIANCE)</change>
        <change type="added">GET /api/v1/reports/case/{case_id}.docx - Generate DOCX report</change>
        <change type="added">GET /api/v1/reports/templates - List available templates</change>
        <change type="added">GET /api/v1/reports/health - Report service health check</change>
        <change type="added">Report sections: cover page, executive summary, case details, timeline, findings, evidence, similar cases, entities</change>
        <change type="added">Severity-colored findings, watermark support, AI-generated summaries in reports</change>
        <change type="milestone">Phase 2 (Document Intelligence) COMPLETED - All 12 features done</change>
      </changes>
    </entry>
    <entry date="2026-01-15" version="0.2.5" phase="2">
      <changes>
        <change type="added">Feature 2.10: AI Case Summarization with Ollama llama3.2</change>
        <change type="added">POST /api/v1/ai/summarize/{case_id} - Generate structured case summary</change>
        <change type="added">summarize_case_structured() method with key_points, risk_assessment, recommendations</change>
        <change type="added">get_case_findings(), get_case_timeline(), get_case_evidence() context builders</change>
        <change type="added">Structured LLM response parsing with confidence scores</change>
        <change type="updated">GET /api/v1/ai/health - Real health checks for Ollama and embedding service</change>
      </changes>
    </entry>
    <entry date="2026-01-15" version="0.2.4" phase="2">
      <changes>
        <change type="added">Feature 2.8: Embedding Service with Ollama nomic-embed-text</change>
        <change type="added">POST /api/v1/ai/embed/case/{case_id} - Generate case embeddings</change>
        <change type="added">GET /api/v1/ai/similar-cases/{case_id} - Find similar cases via pgvector</change>
        <change type="added">GET /api/v1/ai/embeddings/health - Embedding service health check</change>
        <change type="added">Text chunking for long documents (8000 char chunks)</change>
        <change type="added">768-dimension vectors stored in pgvector</change>
        <change type="fixed">SQL CAST syntax for asyncpg compatibility</change>
      </changes>
    </entry>
    <entry date="2026-01-15" version="0.2.3" phase="2">
      <changes>
        <change type="added">Feature 2.6: Entity Extraction Service</change>
        <change type="added">Feature 2.7: Entity Storage and Search</change>
        <change type="added">POST /api/v1/entities/extract - Extract entities from text</change>
        <change type="added">POST /api/v1/entities/store - Store entities for case</change>
        <change type="added">GET /api/v1/entities/case/{case_id} - List case entities</change>
        <change type="added">GET /api/v1/entities/search - Cross-case entity search</change>
        <change type="added">Regex patterns for employee IDs, IPs, emails, hostnames, MACs, USB devices</change>
      </changes>
    </entry>
    <entry date="2026-01-14" version="0.2.2" phase="2">
      <changes>
        <change type="added">Feature 2.3: Paperless-ngx Docker service with Redis</change>
        <change type="added">Feature 2.4: Paperless connector service (paperless_service.py)</change>
        <change type="added">Feature 2.5: Evidence sync pipeline with OCR support</change>
        <change type="added">GET /api/v1/sync/status - Paperless health check</change>
        <change type="added">POST /api/v1/sync/case/{case_id} - Sync all case evidence</change>
        <change type="added">POST /api/v1/sync/evidence/{evidence_id} - Sync single file</change>
        <change type="added">POST /api/v1/sync/evidence/{evidence_id}/extract - Retrieve OCR text</change>
        <change type="added">GET /api/v1/sync/paperless/search - Search Paperless docs</change>
        <change type="added">Separate PostgreSQL database for Paperless</change>
      </changes>
      <git_commit>5f67c19</git_commit>
    </entry>
    <entry date="2026-01-14" version="0.2.1" phase="2">
      <changes>
        <change type="added">Feature 2.2: JWT Authentication System</change>
        <change type="added">Password hashing with bcrypt via passlib</change>
        <change type="added">POST /api/v1/auth/login - JWT token generation</change>
        <change type="added">POST /api/v1/auth/register - Admin-only user registration</change>
        <change type="added">GET /api/v1/auth/me - Current user profile endpoint</change>
        <change type="added">JWT middleware protecting all routes except health/login</change>
        <change type="added">Role-based access control (admin, auditor, reviewer, viewer)</change>
        <change type="added">Security utilities (api/app/utils/security.py)</change>
        <change type="added">Auth service (api/app/services/auth_service.py)</change>
        <change type="fixed">bcrypt compatibility with passlib (pinned bcrypt==4.0.1)</change>
        <change type="fixed">Settings singleton export in config.py</change>
      </changes>
    </entry>
    <entry date="2026-01-14" version="0.2.0" phase="2">
      <changes>
        <change type="added">Feature 2.1: Complete Database CRUD Operations</change>
        <change type="added">Cases router with full DB persistence</change>
        <change type="added">Evidence router with MinIO file storage</change>
        <change type="added">Timeline events CRUD operations</change>
        <change type="added">Findings CRUD with severity ordering</change>
        <change type="added">Audit logging for all operations</change>
        <change type="fixed">asyncpg SQL type casting (CAST syntax)</change>
        <change type="fixed">Admin user email validation</change>
      </changes>
      <git_commit>ed224f1</git_commit>
    </entry>
    <entry date="2026-01-14" version="0.1.0" phase="1">
      <changes>
        <change type="added">Initial project creation with Phase 1 features</change>
        <change type="added">Docker Compose with PostgreSQL, MinIO, Ollama, FastAPI</change>
        <change type="added">Complete API structure with routers, models, schemas, services</change>
        <change type="added">Case ID generation system (SCOPE-TYPE-SEQ)</change>
        <change type="added">PROJECT_SPEC.xml for project tracking</change>
        <change type="fixed">DATABASE_URL async driver configuration</change>
        <change type="fixed">email-validator dependency</change>
        <change type="fixed">Path vs Query parameter in cases router</change>
      </changes>
      <git_commit>823359f</git_commit>
    </entry>
  </changelog>

  <!-- ============================================== -->
  <!-- QUICK REFERENCE                                -->
  <!-- ============================================== -->
  <quick_reference>
    <commands>
      <command name="Start services">docker compose up -d</command>
      <command name="View logs">docker compose logs -f api</command>
      <command name="Rebuild API">docker compose up -d --build api</command>
      <command name="Rebuild Frontend">docker compose up -d --build frontend</command>
      <command name="Stop services">docker compose down</command>
      <command name="Reset data">docker compose down -v</command>
      <command name="Access DB">docker exec -it auditcaseos-db psql -U auditcaseos -d auditcaseos</command>
      <command name="Pull Ollama model">docker exec -it auditcaseos-ollama ollama pull llama3.2</command>
      <command name="Run all tests">bash scripts/test-all.sh</command>
      <command name="Run sync tests">bash scripts/test-evidence-sync.sh</command>
    </commands>

    <urls>
      <url name="API Docs">http://localhost:18000/docs</url>
      <url name="Health Check">http://localhost:18000/health</url>
      <url name="MinIO Console">http://localhost:19001</url>
      <url name="Paperless">http://localhost:18080</url>
      <url name="Nextcloud">http://localhost:18081</url>
      <url name="ONLYOFFICE">http://localhost:18082</url>
      <url name="Frontend">http://localhost:13000</url>
    </urls>

    <credentials>
      <credential service="MinIO" user="minioadmin" pass="minioadmin123"/>
      <credential service="PostgreSQL" user="auditcaseos" pass="auditcaseos_secret"/>
      <credential service="Paperless" user="admin" pass="admin123"/>
      <credential service="Nextcloud" user="admin" pass="admin123"/>
      <credential service="API (default admin)" user="admin@example.com" pass="admin123"/>
    </credentials>

    <testing>
      <test_script name="Comprehensive tests">scripts/test-all.sh (19 tests)</test_script>
      <test_script name="Evidence-Nextcloud sync">scripts/test-evidence-sync.sh (24 tests)</test_script>
      <test_script name="ONLYOFFICE integration">scripts/test-onlyoffice.sh (24 tests)</test_script>
      <total_tests>67</total_tests>
    </testing>
  </quick_reference>
</project>
